<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="UTF-8" />
  <title>Ø·Ù„Ø¨ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…ÙƒØªØ¨</title>
  <style>
    body {
      font-family: 'Tahoma', sans-serif;
      background: #eef2f3;
      padding: 20px;
      text-align: center;
      align-items: center;
    }

    .logo-container {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      height: 25vh;
      margin-bottom: 20px;
    }

    .logo {
      height: 100%;
      object-fit: contain;
    }

    input {
      padding: 10px;
      margin: 8px 0;
      width: 50%;
      align-items: center;
      border: 1px solid;
      border-radius: 4px;
      font-size: 22px;
    }

    button {
      padding: 10px;
      margin: 8px 0;
      width: 51.5%;
      align-items: center;
      border: 1px solid;
      border-radius: 4px;
      font-size: 22px;
    }

    ul {
      list-style: none;
      padding: 0;
    }

    li {
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 8px;
      font-size: 20px;
      align-items: center;
      background-color: white;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease, opacity 0.3s ease;
      touch-action: pan-y;
      user-select: none;
      position: relative;
    }

    .waiting {
      background-color: #fff9c4;
    }

    .approved {
      background-color: #c8e6c9;
    }

    .rejected {
      background-color: #ffcdd2;
    }

    .card {
      align-items: center;
      text-align: center;
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }

    .card2 {
      align-items: center;
      text-align: center;
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }

    select.styled-select {
      appearance: none;
      align-items: center;
      text-align: center;
      background-color: #fff;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg fill='%23444' height='20' viewBox='0 0 24 24' width='20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position-x: 98%;
      background-position-y: center;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 24px;
      width: 51.5%;
      border: 1px solid;
      padding: 8px;
    }
  </style>
</head>

<body>
  <audio id="statusSound" src="office.mp3" preload="auto"></audio>

  <div class="logo-container">
    <img src="logo.png" alt="Ø´Ø¹Ø§Ø±" class="logo" />
  </div>

  <div class="card">
    <h2>Ø·Ù„Ø¨ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…ÙƒØªØ¨</h2>

    <input type="text" id="name" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø´Ø®Øµ" />

    <input type="text" id="reason" placeholder="Ø§Ø¯Ø®Ù„ Ø³Ø¨Ø¨ Ø§Ù„Ø¯Ø®ÙˆÙ„" />

    <select id="leader" class="styled-select" required>
      <option value="" disabled selected hidden>Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø§Ø¦Ø¯</option>
      <option value="leader1">Ø§Ù„Ù‚Ø§Ø¦Ø¯ Ø§Ù„Ø£ÙˆÙ„</option>
      <option value="leader2">Ø§Ù„Ù‚Ø§Ø¦Ø¯ Ø§Ù„Ø«Ø§Ù†ÙŠ</option>
    </select>


    <button onclick="addRequest()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ù„Ø¨</button>

  </div>

  <div class="card2">
    <h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</h3>
    <ul id="requestList"></ul>
  </div>

  <script src="http://127.0.0.1:3000/socket.io/socket.io.js"></script>
  <script>
    const socket = io("http://127.0.0.1:3000");
    const requestList = document.getElementById("requestList");
    const statusSound = document.getElementById("statusSound");

    let myRequests = [];
    let soundAllowed = false;

    window.addEventListener("click", () => {
      soundAllowed = true;
    }, { once: true });

    function addRequest() {
      const name = document.getElementById("name").value.trim();
      const reason = document.getElementById("reason").value.trim();
      const leader = document.getElementById("leader").value;

      if (!name || !reason || !leader) {
        alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø³Ø¨Ø¨ ÙˆØ§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ø§Ø¦Ø¯");
        return;
      }

      socket.emit(`entry-${leader}-request`, { name, reason });

      document.getElementById("name").value = "";
      document.getElementById("reason").value = "";
      document.getElementById("leader").value = "";
    }


    socket.on("update-leader1-requests", (requests) => {
      let statusChanged = false;
      for (let newReq of requests) {
        const oldReq = myRequests.find(r => r.id === newReq.id);
        if (oldReq && oldReq.status !== newReq.status) {
          statusChanged = true;
          break;
        }
      }
      myRequests = requests;

      if (soundAllowed && statusChanged) {
        statusSound.play().catch(err => console.warn("ğŸ”‡ Sound blocked:", err.message));
      }

      render();
    });
    socket.on("update-leader2-requests", (requests) => {
      let statusChanged = false;
      for (let newReq of requests) {
        const oldReq = myRequests.find(r => r.id === newReq.id);
        if (oldReq && oldReq.status !== newReq.status) {
          statusChanged = true;
          break;
        }
      }
      myRequests = requests;

      if (soundAllowed && statusChanged) {
        statusSound.play().catch(err => console.warn("ğŸ”‡ Sound blocked:", err.message));
      }

      render();
    });

    function deleteRequest(id, leader) {
      if (leader === "leader1") {
        socket.emit("delete-leader1-request", id);
      } else {
        socket.emit("delete-leader2-request", id);
      }
    }

    function render() {
      requestList.innerHTML = "";

      myRequests.forEach(req => {
        const li = document.createElement("li");
        li.className = req.status;

        const statusText = {
          waiting: "ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±",
          approved: "ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©",
          rejected: "ØªÙ… Ø§Ù„Ø±ÙØ¶"
        };

        if (req.leader == "leader1") {
          li.innerText = `Ø§Ù„Ø§Ø³Ù…: ${req.name}\nØ§Ù„Ø³Ø¨Ø¨: ${req.reason}\nØ§Ù„Ø­Ø§Ù„Ø©: ${statusText[req.status]}\n Ù…Ø±Ø³Ù„ Ø§Ù„ÙŠ: Ø§Ù„Ù‚Ø§Ø¦Ø¯`;
        } else {
          li.innerText = `Ø§Ù„Ø§Ø³Ù…: ${req.name}\nØ§Ù„Ø³Ø¨Ø¨: ${req.reason}\nØ§Ù„Ø­Ø§Ù„Ø©: ${statusText[req.status]}\n Ù…Ø±Ø³Ù„ Ø§Ù„ÙŠ: Ø§Ù„Ù‚Ø§Ø¦Ø¯ Ø§Ù„Ø«Ø§Ù†ÙŠ`;
        }
        <!-- li.innerText = `Ø§Ù„Ø§Ø³Ù…: ${req.name}\nØ§Ù„Ø³Ø¨Ø¨: ${req.reason}\nØ§Ù„Ø­Ø§Ù„Ø©: ${statusText[req.status]}\n Ù…Ø±Ø³Ù„ Ø§Ù„ÙŠ: `; -->

        requestList.appendChild(li);

        if (req.status === "waiting") {
          addSwipeToDelete(li, req.id, req.leader);
        }
      });
    }

    function addSwipeToDelete(element, requestId, leader) {
      let startX = 0;
      let isDragging = false;

      element.addEventListener("pointerdown", (e) => {
        startX = e.clientX;
        isDragging = true;
        element.setPointerCapture(e.pointerId);
      });

      element.addEventListener("pointermove", (e) => {
        if (!isDragging) return;
        const dx = e.clientX - startX;
        element.style.transform = `translateX(${dx}px)`;
        element.style.opacity = Math.abs(dx) > 100 ? 0.5 : 1;
      });

      element.addEventListener("pointerup", (e) => {
        const dx = e.clientX - startX;
        element.releasePointerCapture(e.pointerId);
        isDragging = false;

        if (Math.abs(dx) > 100) {
          element.style.transition = "transform 0.3s ease, opacity 0.3s ease";
          element.style.transform = `translateX(${dx > 0 ? '100%' : '-100%'})`;
          element.style.opacity = 0;

          setTimeout(() => {

            deleteRequest(requestId, leader);
          }, 300);
        } else {
          element.style.transform = "translateX(0)";
          element.style.opacity = 1;
        }
      });
    }
  </script>
</body>

</html>